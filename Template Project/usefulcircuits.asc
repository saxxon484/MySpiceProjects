Version 4
SHEET 1 5412 1748
WIRE -336 -400 -352 -400
WIRE -144 -400 -160 -400
WIRE -336 -384 -336 -400
WIRE -144 -384 -144 -400
WIRE -336 -288 -336 -304
WIRE -336 -288 -352 -288
WIRE -144 -288 -144 -304
WIRE -144 -288 -160 -288
WIRE -336 -272 -336 -288
WIRE -144 -272 -144 -288
WIRE -336 -176 -336 -192
WIRE -336 -176 -352 -176
WIRE -144 -176 -144 -192
WIRE -144 -176 -160 -176
WIRE 1040 144 1040 128
WIRE 1824 160 1632 160
WIRE 3152 160 3152 144
WIRE 2368 176 2368 128
WIRE -272 192 -272 176
WIRE 944 208 944 192
WIRE 912 224 880 224
WIRE 1632 224 1632 160
WIRE 1664 224 1632 224
WIRE 1776 224 1728 224
WIRE 1040 240 1040 224
WIRE 1040 240 976 240
WIRE 2992 240 2976 240
WIRE 3104 240 3072 240
WIRE 912 256 672 256
WIRE 2368 272 2368 256
WIRE -272 288 -272 272
WIRE 672 288 672 256
WIRE 944 288 944 272
WIRE 1824 288 1824 160
WIRE 1856 288 1824 288
WIRE 1968 288 1920 288
WIRE 3152 288 3152 256
WIRE 3200 288 3152 288
WIRE 3360 288 3344 288
WIRE 3472 288 3440 288
WIRE 3568 288 3472 288
WIRE 3472 304 3472 288
WIRE 1536 320 1520 320
WIRE 1632 320 1632 224
WIRE 1632 320 1600 320
WIRE 1664 320 1632 320
WIRE 1776 320 1776 224
WIRE 1776 320 1744 320
WIRE 1856 320 1776 320
WIRE 3152 320 3152 288
WIRE 3568 320 3568 288
WIRE 1520 352 1520 320
WIRE 1520 352 1504 352
WIRE 1536 352 1520 352
WIRE 1776 352 1776 320
WIRE 672 384 672 368
WIRE 2992 400 2976 400
WIRE 3104 400 3072 400
WIRE 3472 416 3472 368
WIRE 3568 416 3568 400
WIRE 3152 432 3152 416
WIRE 1776 448 1776 416
WIRE -272 464 -272 448
WIRE 1040 464 1040 448
WIRE 2368 496 2368 448
WIRE 944 528 944 512
WIRE 1824 528 1632 528
WIRE 912 544 880 544
WIRE -272 560 -272 544
WIRE 1040 560 1040 544
WIRE 1040 560 976 560
WIRE 912 576 672 576
WIRE 1632 592 1632 528
WIRE 1664 592 1632 592
WIRE 1776 592 1728 592
WIRE 2368 592 2368 576
WIRE 672 608 672 576
WIRE 944 608 944 592
WIRE 1536 656 1520 656
WIRE 1824 656 1824 528
WIRE 1856 656 1824 656
WIRE 1968 656 1920 656
WIRE 1520 688 1520 656
WIRE 1520 688 1504 688
WIRE 1536 688 1520 688
WIRE 1632 688 1632 592
WIRE 1632 688 1600 688
WIRE 1664 688 1632 688
WIRE 1776 688 1776 592
WIRE 1776 688 1744 688
WIRE 1856 688 1776 688
WIRE 672 704 672 688
WIRE 1776 720 1776 688
WIRE -272 752 -272 736
WIRE 1776 816 1776 784
WIRE -272 848 -272 832
FLAG -160 -288 0
FLAG -160 -400 +VDD
FLAG -160 -176 -VDD
FLAG 944 288 0
FLAG -272 176 sawtooth
FLAG -272 288 0
FLAG 3152 144 +VDD
FLAG -272 448 triangle
FLAG -272 560 0
FLAG 3200 288 vsw
FLAG 2976 240 q1
FLAG 2976 400 q1p
FLAG 1776 448 0
FLAG -352 -288 0
FLAG -352 -400 +5V
FLAG -352 -176 -5V
FLAG 944 192 +5V
FLAG 1968 288 x1_d
FLAG 2368 128 q1
FLAG 1040 128 +5V
FLAG 2368 272 vsw
FLAG 3152 432 0
FLAG -272 736 square
FLAG -272 848 0
FLAG 672 384 0
FLAG 880 224 sawtooth
FLAG 1504 352 square
FLAG 944 608 0
FLAG 944 512 +5V
FLAG 1040 448 +5V
FLAG 672 704 0
FLAG 880 544 triangle
FLAG 2368 448 q1p
FLAG 2368 592 0
FLAG 1776 816 0
FLAG 1968 656 x1p_d
FLAG 1504 688 square
FLAG 3344 288 vsw
FLAG 3472 416 0
FLAG 3568 416 0
SYMBOL OpAmps\\opamp2 944 176 R0
SYMATTR InstName U1
SYMATTR Value LM339
SYMBOL voltage -144 -400 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value {VDD}
SYMBOL voltage -144 -288 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value {VDD}
SYMBOL res 1024 128 R0
SYMATTR InstName R5
SYMATTR Value 10k
SYMBOL voltage -272 176 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V4
SYMATTR Value PULSE(0 {Vp} 0 {T} 1p {1p} {T})
SYMBOL nmos 3104 160 R0
SYMATTR InstName M1
SYMATTR Value IRF530
SYMBOL voltage -272 448 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V5
SYMATTR Value PULSE(0 {Vp} 0 {T/2} {T/2} {1p} {T})
SYMBOL nmos 3104 320 R0
SYMATTR InstName M2
SYMATTR Value IRF530
SYMBOL diode 1728 208 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D3
SYMATTR Value 1N914
SYMBOL cap 1760 352 R0
SYMATTR InstName C1
SYMATTR Value {C_dt}
SYMBOL voltage -336 -400 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V6
SYMATTR Value 5
SYMBOL voltage -336 -288 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V7
SYMATTR Value 5
SYMBOL bv 2368 160 R0
SYMATTR InstName B1
SYMATTR Value V=IF(V(x1_d), 12, 0)
SYMBOL bv 2368 480 R0
SYMATTR InstName B3
SYMATTR Value V=IF(V(x1p_d), 12, 0)
SYMBOL Digital\\and 1888 240 R0
SYMATTR InstName A4
SYMBOL Digital\\and 1568 272 R0
SYMATTR InstName A5
SYMBOL res 1760 304 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R12
SYMATTR Value {R_dt}
SYMBOL voltage -272 736 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V3
SYMATTR Value PULSE(0 {Vp} 0 {1p} {1p} {D*T} {T})
SYMBOL voltage 672 272 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V8
SYMATTR Value {Vp*D}
SYMBOL OpAmps\\opamp2 944 496 R0
SYMATTR InstName U2
SYMATTR Value LM339
SYMBOL res 1024 448 R0
SYMATTR InstName R1
SYMATTR Value 10k
SYMBOL voltage 672 592 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V9
SYMATTR Value {Vp*D}
SYMBOL diode 1728 576 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D1
SYMATTR Value 1N914
SYMBOL cap 1760 720 R0
SYMATTR InstName C2
SYMATTR Value {C_dt}
SYMBOL Digital\\and 1888 608 R0
SYMATTR InstName A1
SYMBOL Digital\\and 1568 608 R0
SYMATTR InstName A2
SYMBOL res 1760 672 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value {R_dt}
SYMBOL ind 3344 304 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L1
SYMATTR Value 1mH
SYMBOL cap 3456 304 R0
SYMATTR InstName C3
SYMATTR Value 10µF
SYMBOL res 3552 304 R0
SYMATTR InstName R3
SYMATTR Value 10
SYMBOL res 3088 224 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value {RG}
SYMBOL res 3088 384 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R6
SYMATTR Value {RG}
SYMBOL diode -304 1184 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D2
SYMATTR Value Dideal
SYMBOL OpAmps\\opamp2 -272 1232 R0
SYMATTR InstName U3
SYMATTR Value LM339
SYMBOL OpAmps\\opamp2 -272 1376 R0
SYMATTR InstName U4
SYMATTR Value LM358
SYMBOL sw -272 1616 M180
SYMATTR InstName S1
SYMATTR Value Switch
TEXT -392 -640 Left 2 !.param f 100k\n.param T 1/f\n.param D 0.4\n.param Vp 1V\n.param VDD 12V
TEXT 2440 -656 Left 2 !.tran 0 10m 0
TEXT 416 -632 Left 2 !.options gmin=1e-10\n.options abstol=1e-10\n.options reltol=0.001\n.options cshunt=1e-15
TEXT 1608 64 Left 2 !.param R_dt 12k\n.param C_dt 10pF
TEXT -464 -680 Left 4 ;Parameters and Voltage Supplies
TEXT 760 0 Left 4 ;PWM generation
TEXT 1624 0 Left 4 ;Deadtime
TEXT 2256 0 Left 4 ;Gate Driver
TEXT 2920 0 Left 4 ;H-Bridge and sample buck converter
TEXT -376 8 Left 4 ;Triangle/Sawtooth/Square
TEXT 400 -680 Left 4 ;Some commands to make simulation converge
TEXT 1512 -672 Left 4 ;Subcircuits
TEXT 1512 -616 Left 2 !.lib LM358.sub\n.lib LM339.sub\n.model DL1A D(Ron=1u Vfwd=0 Roff=100g ilimit=1)\n.model DL2A D(Ron=1u Vfwd=0 Roff=100g ilimit=2)\n.model DL5A D(Ron=1u Vfwd=0 Roff=100g ilimit=5)\n.model Dideal D(Ron=1u Roff=1Meg Vfwd=0)\n.model Switch SW(Roff=100Meg Ron=1u Vt=0.5 Vh=0)
TEXT 2176 -616 Left 2 ;<= Op-amp\n<= Comparator\n<= 1A current limiter\n<= 2A current limiter\n<= 5A current limiter
TEXT 2944 48 Left 2 !.param RG 10
TEXT -392 1088 Left 4 ;Custom Components
